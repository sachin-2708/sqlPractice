-- There are multiple antivirus software which are running on the system and you have the data of how many malware they have detected in each run.  You need to find out how many malwares each software has detected in their latest run and what is the difference between the number of malwares detected in latest run and the second last run for each software. 
-- Please note that list only the software which have run for at least 2 times and have detected at least 10 malware in the latest run.
-- 
/*Table: malware
+------------------+-----------+
| COLUMN_NAME      | DATA_TYPE |
+------------------+-----------+
| software_id      | int       |
| run_date         | datetime  |
| malware_detected | int       |
+------------------+-----------+ */

WITH cte AS 
(SELECT *, 
 	ROW_NUMNER()OVER(PARTITION BY software_id ORDER BY run_date DESC) AS rnk,
	LEAD(malware_detected) OVER(PARTITION BY software_id ORDER BY run_date DESC) AS previous_day,
	COUNT(*) OVER(PARTITION BY software_id) AS cnt
FROM malware)

SELECT 
	  software_id, 
    malware_detected AS latest_run_count, 
    malware_detected - previous_day AS difference_to_previous
FROM cte
WHERE rnk = 1 AND cte.malware_detected >= 10 AND cnt >= 2
